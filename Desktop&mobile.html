<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Omar IPTV Pro</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:white;
}

/* HEADER */
header{
  display:flex;
  align-items:center;
  padding:15px 20px;
  background:#141414;
}

#menuBtn{
  font-size:24px;
  cursor:pointer;
  margin-right:15px;
}

h1{
  margin:0;
  color:#00ccff;
  font-size:20px;
}

/* LAYOUT */
#layout{display:flex;}

#sidebar{
  width:250px;
  background:#181818;
  height:100vh;
  position:fixed;
  left:-250px;
  transition:0.3s;
  padding:15px;
  overflow-y:auto;
  z-index:1000;
}

#sidebar.active{left:0;}

.sidebar-section{margin-bottom:25px;}

.sidebar-section h3{
  color:#00ccff;
  margin-bottom:10px;
}

.sidebar-section ul{
  list-style:none;
  padding:0;
}

.sidebar-section li{
  padding:8px 0;
  cursor:pointer;
  border-bottom:1px solid #333;
}

#main{
  flex:1;
  padding:20px;
  transition:0.3s;
}

#main.shift{margin-left:250px;}

/* PLAYER */
#playerContainer{
  max-width:1000px;
  margin:auto;
}

video{
  width:100%;
  border-radius:8px;
  background:black;
}

/* SEARCH */
#search{
  width:100%;
  max-width:1000px;
  margin:20px auto;
  display:block;
  padding:12px;
  border-radius:8px;
  border:none;
  font-size:16px;
  background:#1f1f1f;
  color:white;
}

/* GRID */
#channelGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:18px;
  max-width:1200px;
  margin:auto;
}

.channelCard{
  background:#1b1b1b;
  border-radius:8px;
  overflow:hidden;
  cursor:pointer;
  transition:0.3s;
  position:relative;
}

.channelCard:hover{
  transform:scale(1.05);
  box-shadow:0 8px 20px rgba(0,0,0,0.6);
}

.channelCard img{
  width:100%;
  height:120px;
  object-fit:contain;
  background:black;
}

.channelName{
  padding:10px;
  font-size:14px;
  text-align:center;
}

.favBtn{
  position:absolute;
  top:8px;
  right:8px;
  font-size:18px;
  color:gold;
  cursor:pointer;
}

/* LOAD MORE */
#loadMoreBtn{
  display:none;
  margin:30px auto;
  padding:10px 20px;
  border:none;
  border-radius:6px;
  background:#ff9800;
  cursor:pointer;
}

/* MOBILE */
@media(max-width:768px){
  #sidebar{
    width:80%;
    left:-80%;
  }
  #sidebar.active{left:0;}
  #main.shift{margin-left:0;}
  .channelCard img{
    height:100px;
  }
}
</style>
</head>
<body>

<header>
<div id="menuBtn">☰</div>
<h1>Omar IPTV Pro</h1>
</header>

<div id="layout">

<div id="sidebar">

  <div class="sidebar-section">
    <h3>Categories</h3>
    <ul id="categories"></ul>
  </div>

  <div class="sidebar-section">
    <h3>Favorites</h3>
    <ul id="favorites"></ul>
  </div>

</div>

<div id="main">

<div id="playerContainer">
<video id="player" controls playsinline></video>
</div>

<input type="text" id="search" placeholder="Search channels...">

<div id="channelGrid"></div>

<div style="text-align:center;">
<button id="loadMoreBtn">Load More</button>
</div>

</div>
</div>

<script>
const playlistURL="playlist.m3u";
const player=document.getElementById("player");
const grid=document.getElementById("channelGrid");
const searchInput=document.getElementById("search");
const sidebar=document.getElementById("sidebar");
const main=document.getElementById("main");
const categoriesList=document.getElementById("categories");
const favoritesList=document.getElementById("favorites");
const loadMoreBtn=document.getElementById("loadMoreBtn");

let channels=[];
let categories={};
let visibleChannels=[];
let currentIndex=0;
const batchSize=24;
let favorites=JSON.parse(localStorage.getItem("favorites")||"[]");

document.getElementById("menuBtn").onclick=()=>{
  sidebar.classList.toggle("active");
  main.classList.toggle("shift");
};

/* RENDER GRID */
function renderChannels(list){
  visibleChannels=list;
  currentIndex=0;
  grid.innerHTML="";
  loadMoreBtn.style.display="block";
  loadNextBatch();
}

function loadNextBatch(){
  const batch=visibleChannels.slice(currentIndex,currentIndex+batchSize);

  batch.forEach(ch=>{
    const card=document.createElement("div");
    card.className="channelCard";

    card.innerHTML=`
      <img src="${ch.logo || 'https://via.placeholder.com/300x150'}"
           loading="lazy"
           onerror="this.src='https://via.placeholder.com/300x150'">
      <div class="channelName">${ch.name}</div>
      <div class="favBtn">★</div>
    `;

    card.onclick=()=>playStream(ch.url);
    card.querySelector(".favBtn").onclick=(e)=>{
      e.stopPropagation();
      toggleFavorite(ch);
    };

    grid.appendChild(card);
  });

  currentIndex+=batchSize;
  if(currentIndex>=visibleChannels.length){
    loadMoreBtn.style.display="none";
  }
}

loadMoreBtn.onclick=loadNextBatch;

/* PLAY */
function playStream(url){
  if(url.endsWith(".m3u8") && Hls.isSupported()){
    const hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(player);
  }else{
    player.src=url;
  }
  player.play();
}

/* FAVORITES */
function toggleFavorite(ch){
  const exists=favorites.find(c=>c.url===ch.url);
  if(exists){
    favorites=favorites.filter(c=>c.url!==ch.url);
  }else{
    favorites.push(ch);
  }
  localStorage.setItem("favorites",JSON.stringify(favorites));
  renderFavorites();
}

function renderFavorites(){
  favoritesList.innerHTML="";
  favorites.forEach(c=>{
    const li=document.createElement("li");
    li.textContent=c.name;
    li.onclick=()=>renderChannels([c]);
    favoritesList.appendChild(li);
  });
}

/* LOAD PLAYLIST */
fetch(playlistURL)
.then(r=>r.text())
.then(text=>{
  const lines=text.split(/\r?\n/);
  let current={};

  lines.forEach(line=>{
    if(line.startsWith("#EXTINF")){
      current.name=line.match(/,(.*)$/)?.[1]||"Unnamed";
      current.category=line.match(/group-title="([^"]+)"/)?.[1]||"Other";
      current.logo=line.match(/tvg-logo="([^"]+)"/)?.[1]||"";
    }
    else if(line && !line.startsWith("#")){
      current.url=line.trim();
      channels.push(current);

      if(!categories[current.category]) categories[current.category]=[];
      categories[current.category].push(current);

      current={};
    }
  });

  renderChannels(channels);
  renderCategories();
});

/* CATEGORIES */
function renderCategories(){
  categoriesList.innerHTML="";
  Object.keys(categories).forEach(cat=>{
    const li=document.createElement("li");
    li.textContent=cat;
    li.onclick=()=>renderChannels(categories[cat]);
    categoriesList.appendChild(li);
  });
}

/* SEARCH */
searchInput.addEventListener("input",()=>{
  const q=searchInput.value.toLowerCase();
  renderChannels(channels.filter(c=>c.name.toLowerCase().includes(q)));
});

renderFavorites();
</script>

</body>
</html>
